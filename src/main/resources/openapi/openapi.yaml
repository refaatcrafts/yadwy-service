openapi: 3.0.3

info:
  title: Yadwy API
  description: Yadwy Handmade Marketplace Backend API
  version: 1.0.0
  contact:
    name: Backend Team
    email: backend@yadwy.app

servers:
  - url: http://localhost:8080
    description: Local development

tags:
  - name: Hello
    description: Health check and greeting endpoints
  - name: Login
    description: User login endpoint
  - name: Token
    description: Token refresh endpoint
  - name: CustomerRegistration
    description: Customer registration endpoint
  - name: SellerRegistration
    description: Seller registration endpoint
  - name: CreateCategory
    description: Create category endpoint
  - name: UpdateCategory
    description: Update category endpoint
  - name: DeleteCategory
    description: Delete category endpoint
  - name: GetCategory
    description: Get category endpoint
  - name: ListCategories
    description: List categories endpoint
  - name: CreateProduct
    description: Create product endpoint
  - name: UpdateProduct
    description: Update product endpoint
  - name: DeleteProduct
    description: Delete product endpoint
  - name: GetProduct
    description: Get product endpoint
  - name: ListProducts
    description: List products endpoint
  - name: UpdateProductVisibility
    description: Update product visibility endpoint

paths:
  /api/v1/auth/register/customer:
    post:
      operationId: registerCustomer
      tags:
        - CustomerRegistration
      summary: Register a new customer
      description: Creates a new customer account and returns authentication tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterCustomerRequestDto'
      responses:
        '201':
          description: Customer registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterCustomerResponseDto'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '409':
          description: Account already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /api/v1/auth/register/seller:
    post:
      operationId: registerSeller
      tags:
        - SellerRegistration
      summary: Register a new seller
      description: Creates a new seller account and returns authentication tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterSellerRequestDto'
      responses:
        '201':
          description: Seller registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterSellerResponseDto'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '409':
          description: Account already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /api/v1/auth/login:
    post:
      operationId: login
      tags:
        - Login
      summary: Login
      description: Authenticates user and returns access and refresh tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequestDto'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponseDto'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /api/v1/auth/refresh:
    post:
      operationId: refreshAccessToken
      tags:
        - Token
      summary: Refresh access token
      description: Generates a new access token using a valid refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequestDto'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponseDto'
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /api/v1/categories:
    post:
      operationId: createCategory
      tags:
        - CreateCategory
      summary: Create a new category
      description: Creates a new product category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCategoryRequestDto'
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryResponseDto'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '409':
          description: Slug already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    get:
      operationId: listCategories
      tags:
        - ListCategories
      summary: List categories
      description: |
        Returns categories with optional filtering and nesting.
        - Without parameters: returns root categories (parentId = null)
        - With parentId: returns direct children of that category
        - With include=children: returns full tree structure with nested children
      parameters:
        - name: parentId
          in: query
          required: false
          schema:
            type: integer
            format: int64
          description: Parent category ID (omit for root categories)
        - name: include
          in: query
          required: false
          schema:
            type: string
            enum: [children]
          description: Include nested children in response (use 'children' for tree structure)
      responses:
        '200':
          description: List of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategoryResponseDto'

  /api/v1/categories/{id}:
    get:
      operationId: getCategory
      tags:
        - GetCategory
      summary: Get category by ID
      description: Returns a single category by its ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Category ID
      responses:
        '200':
          description: Category details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryResponseDto'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    put:
      operationId: updateCategory
      tags:
        - UpdateCategory
      summary: Update category
      description: Updates an existing category
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Category ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCategoryRequestDto'
      responses:
        '200':
          description: Category updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryResponseDto'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    delete:
      operationId: deleteCategory
      tags:
        - DeleteCategory
      summary: Delete category
      description: Deletes a category (fails if category has children)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Category ID
      responses:
        '204':
          description: Category deleted successfully
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '409':
          description: Category has child categories
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /api/v1/products:
    post:
      operationId: createProduct
      tags:
        - CreateProduct
      summary: Create a new product
      description: Creates a new product for the authenticated seller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductRequestDto'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponseDto'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Seller or category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    get:
      operationId: listProducts
      tags:
        - ListProducts
      summary: List products
      description: |
        Returns products with optional filtering.
        - Without parameters: returns all visible products
        - With sellerId: returns all products for that seller
        - With categoryId: returns products in that category
        - With visible=true: returns only visible products
      parameters:
        - name: sellerId
          in: query
          required: false
          schema:
            type: integer
            format: int64
          description: Filter by seller ID
        - name: categoryId
          in: query
          required: false
          schema:
            type: integer
            format: int64
          description: Filter by category ID
        - name: visible
          in: query
          required: false
          schema:
            type: boolean
          description: Filter by visibility status
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductResponseDto'

  /api/v1/products/{id}:
    get:
      operationId: getProduct
      tags:
        - GetProduct
      summary: Get product by ID
      description: Returns a single product by its ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Product ID
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponseDto'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    put:
      operationId: updateProduct
      tags:
        - UpdateProduct
      summary: Update product
      description: Updates an existing product (seller must own the product)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Product ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProductRequestDto'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponseDto'
        '403':
          description: Product not owned by seller
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    delete:
      operationId: deleteProduct
      tags:
        - DeleteProduct
      summary: Delete product
      description: Deletes a product (seller must own the product)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Product ID
      responses:
        '204':
          description: Product deleted successfully
        '403':
          description: Product not owned by seller
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /api/v1/products/{id}/visibility:
    patch:
      operationId: updateProductVisibility
      tags:
        - UpdateProductVisibility
      summary: Update product visibility
      description: Toggles product visibility in the marketplace (seller must own the product)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Product ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProductVisibilityRequestDto'
      responses:
        '200':
          description: Product visibility updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponseDto'
        '403':
          description: Product not owned by seller
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

components:
  schemas:
    LocalizedDto:
      type: object
      required:
        - ar
      properties:
        ar:
          type: string
          description: Arabic text
          example: "إلكترونيات"
        en:
          type: string
          description: English text
          example: "Electronics"

    RegisterCustomerRequestDto:
      type: object
      required:
        - name
        - phoneNumber
        - password
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Customer full name
          example: "Ahmed Hassan"
        phoneNumber:
          type: string
          pattern: '^\+?[1-9]\d{1,14}$'
          description: Phone number in E.164 format
          example: "+201234567890"
        password:
          type: string
          minLength: 6
          maxLength: 128
          description: User password (minimum 6 characters)
          example: "SecurePass123"

    RegisterCustomerResponseDto:
      type: object
      required:
        - accountId
        - accessToken
        - refreshToken
      properties:
        accountId:
          type: integer
          format: int64
          description: Created account ID
          example: 12345
        accessToken:
          type: string
          description: JWT access token (expires in 24 hours)
          example: "eyJhbGciOiJIUzI1NiIs..."
        refreshToken:
          type: string
          description: JWT refresh token (expires in 30 days)
          example: "eyJhbGciOiJIUzI1NiIs..."

    RegisterSellerRequestDto:
      type: object
      required:
        - name
        - phoneNumber
        - password
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Seller full name
          example: "Fatima Ali"
        phoneNumber:
          type: string
          pattern: '^\+?[1-9]\d{1,14}$'
          description: Phone number in E.164 format
          example: "+201234567890"
        password:
          type: string
          minLength: 6
          maxLength: 128
          description: User password (minimum 6 characters)
          example: "SecurePass123"

    RegisterSellerResponseDto:
      type: object
      required:
        - accountId
        - accessToken
        - refreshToken
      properties:
        accountId:
          type: integer
          format: int64
          description: Created account ID
          example: 12345
        accessToken:
          type: string
          description: JWT access token (expires in 24 hours)
          example: "eyJhbGciOiJIUzI1NiIs..."
        refreshToken:
          type: string
          description: JWT refresh token (expires in 30 days)
          example: "eyJhbGciOiJIUzI1NiIs..."

    LoginRequestDto:
      type: object
      required:
        - phoneNumber
        - password
      properties:
        phoneNumber:
          type: string
          description: Registered phone number
          example: "+201234567890"
        password:
          type: string
          description: User password
          example: "SecurePass123"

    LoginResponseDto:
      type: object
      required:
        - accessToken
        - refreshToken
      properties:
        accessToken:
          type: string
          description: JWT access token (expires in 24 hours)
          example: "eyJhbGciOiJIUzI1NiIs..."
        refreshToken:
          type: string
          description: JWT refresh token (expires in 30 days)
          example: "eyJhbGciOiJIUzI1NiIs..."

    RefreshTokenRequestDto:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: Valid refresh token
          example: "eyJhbGciOiJIUzI1NiIs..."

    RefreshTokenResponseDto:
      type: object
      required:
        - accessToken
      properties:
        accessToken:
          type: string
          description: New JWT access token (expires in 24 hours)
          example: "eyJhbGciOiJIUzI1NiIs..."

    ApiError:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          example: "VALIDATION_ERROR"
        message:
          type: string
          example: "Invalid request"

    CreateCategoryRequestDto:
      type: object
      required:
        - name
        - slug
      properties:
        name:
          $ref: '#/components/schemas/LocalizedDto'
        slug:
          type: string
          maxLength: 100
#          pattern: '^[a-z0-9]+(-[a-z0-9]+)*$'
          description: URL-friendly identifier
          example: "electronics"
        imageUrl:
          type: string
          maxLength: 500
          description: Category image URL
          example: "https://example.com/images/electronics.png"
        description:
          $ref: '#/components/schemas/LocalizedDto'
        parentId:
          type: integer
          format: int64
          description: Parent category ID (null for root categories)
          example: null

    UpdateCategoryRequestDto:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/LocalizedDto'
        imageUrl:
          type: string
          maxLength: 500
          description: Category image URL
          example: "https://example.com/images/electronics.png"
        description:
          $ref: '#/components/schemas/LocalizedDto'

    CategoryResponseDto:
      type: object
      required:
        - id
        - name
        - slug
      properties:
        id:
          type: integer
          format: int64
          description: Category ID
          example: 1
        name:
          $ref: '#/components/schemas/LocalizedDto'
        slug:
          type: string
          description: URL-friendly identifier
          example: "electronics"
        description:
          $ref: '#/components/schemas/LocalizedDto'
        imageUrl:
          type: string
          description: Category image URL
          example: "https://example.com/images/electronics.png"
        parentId:
          type: integer
          format: int64
          description: Parent category ID
          example: null
        children:
          type: array
          description: Child categories (only present when include=children)
          items:
            $ref: '#/components/schemas/CategoryResponseDto'

    CreateProductRequestDto:
      type: object
      required:
        - name
        - price
        - categoryId
      properties:
        name:
          $ref: '#/components/schemas/LocalizedDto'
        description:
          $ref: '#/components/schemas/LocalizedDto'
        images:
          type: array
          items:
            type: string
          default: []
          description: List of image URLs
        price:
          type: number
          format: double
          minimum: 0
          description: Product price
          example: 99.99
        compareAtPrice:
          type: number
          format: double
          minimum: 0
          description: Original price before discount
          example: 149.99
        categoryId:
          type: integer
          format: int64
          description: Category ID
          example: 1
        stock:
          type: integer
          minimum: 0
          default: 0
          description: Available stock quantity
          example: 100
        trackInventory:
          type: boolean
          default: true
          description: Whether to track and decrement stock on orders
        visible:
          type: boolean
          default: false
          description: Whether product is visible in marketplace

    UpdateProductRequestDto:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/LocalizedDto'
        description:
          $ref: '#/components/schemas/LocalizedDto'
        images:
          type: array
          items:
            type: string
          description: List of image URLs
        price:
          type: number
          format: double
          minimum: 0
          description: Product price
        compareAtPrice:
          type: number
          format: double
          minimum: 0
          description: Original price before discount
        stock:
          type: integer
          minimum: 0
          description: Available stock quantity
        trackInventory:
          type: boolean
          description: Whether to track and decrement stock on orders
        visible:
          type: boolean
          description: Whether product is visible in marketplace

    UpdateProductVisibilityRequestDto:
      type: object
      required:
        - visible
      properties:
        visible:
          type: boolean
          description: Whether product is visible in marketplace

    ProductResponseDto:
      type: object
      required:
        - id
        - sellerId
        - name
        - images
        - price
        - categoryId
        - stock
        - trackInventory
        - visible
      properties:
        id:
          type: integer
          format: int64
          description: Product ID
          example: 1
        sellerId:
          type: integer
          format: int64
          description: Seller ID
          example: 1
        name:
          $ref: '#/components/schemas/LocalizedDto'
        description:
          $ref: '#/components/schemas/LocalizedDto'
        images:
          type: array
          items:
            type: string
          description: List of image URLs
        price:
          type: number
          format: double
          description: Product price
          example: 99.99
        compareAtPrice:
          type: number
          format: double
          description: Original price before discount
          example: 149.99
        categoryId:
          type: integer
          format: int64
          description: Category ID
          example: 1
        stock:
          type: integer
          description: Available stock quantity
          example: 100
        trackInventory:
          type: boolean
          description: Whether to track and decrement stock on orders
        visible:
          type: boolean
          description: Whether product is visible in marketplace
